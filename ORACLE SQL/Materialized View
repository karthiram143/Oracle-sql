-- Materialized view:
 is a view that stores the results of the views query
 snapshot of the dataDML operation not applicable
--  Advantage:
 used to improve the efficiency  of a query
 materialized view can also be used to simplify a query
--  Disadvantages:
 the data needs to be refreshed/ the data need to be updated
 data may be inconsistent 
 stores data physically
--  sun:
 CREATE MATERIALIZED VIEW viewname(BULID IMMEDIATE| BUILD DEFERRED)
(REFRESH(FASE|COMPETE|FORCE)(ON DEMAND|ON COMMIT))
AS select Query;

-- simple 
-- syntax:
CREATE MATERIALIZED VIEW viewname asselect Query;
-- ex:
CREATE materialized VIEW M_emp As select * from employee

-- WHILE QUERY THE materialized same result
-- If i am delete the records from the employee table it got delete but it not delete in the view

    -- Materialized view refresh Methods:
 Complete Refersh
 fast refresh
 force Refresh
--  complete refresh
  scans the whole table and then do the refresh
--   SYN:
Create MATERIALIZED VIEW viewname (build IMMDEIATE |BULID DEFERRED)
(REFERSH COMPLETE)(ON DEMAND|ON COMMOTP)
AS SELECT AQUERY

BULID IMMEDIATE-DEFUALT
Refresh complete - on demand -is default
-- EX:
CREATE MATERIALIZED VIEW employee_mtd1
REFRESH COMPLETE
AS SELECT * FROM EMPLOYEE

SELECT * FROM USER_MVIEWS

while delete 
select * FROM employee
Delete from employee where employee_id=1--AFTE DELETE NOT THERE IN THE EMPLOYEE TBALE

SELECT * FROM employee_mtd1 --ITS THERE DELETRE VALUES , I WANT TO REFERSH
--1:
BEGIN
DBMS_MVIEW.refresh('employee_mtd1','c');
end;
/
--2:
Exec dbms_view.refresh('employee_mtd1','c');

-- after query  data got deleted with latest data in MVIEW
SELECT * FROM employee_mtd1

-- MEHTOD -2
CREATE MATERIALIZED VIEW employee_mtd2
BUILD DEFERRED
REFRESH COMPLETE
AS SELECT * FROM EMPLOYEE

SELECT * FROM USER_MVIEWS,--LAST_REFRESH_TYPELAST_REFRESH_DATE,LAST_REFRESH_END_TIME IS blank for 1st time after refresh the data will reachived

-- MEHTOD -3(ALL)
CREATE MATERIALIZED VIEW employee_mtd3
BUILD DEFERRED
REFRESH COMPLETE ON COMMIT --WHEN EVER I USE THE COMMIT IT COMMIT AUTOMATICALLY ITS BLANK AFTER REFERSH ONLY THE DATA GOT REACHIVED IN THE COME
AS SELECT * FROM EMPLOYEE

COMPILE:
BEGIN
DBMS_MVIEW.refresh('employee_mtd1','c');
end;

-- DELETE STATEMENT
Delete from employee where employee_id=2

SELECT * FROM employee;
COMMIT;-- NOT THERE 2 ND RECORDS

SELECT * FROM employee_mtd3

-- MEHTOD -4(NOT BUILD DEFERRED)
CREATE MATERIALIZED VIEW employee_mtd4
REFRESH COMPLETE ON COMMIT 
AS SELECT * FROM EMPLOYEE
-- DELETE STATEMENT
Delete from employee where employee_id=4;--NOT THERE

SELECT * FROM employee_mtd3-- THERE

-- AFTER 
COMMIT;
SELECT * FROM employee_mtd3--NOT THERE

-- FAST REFERSH 

 Updates only the changes we have changed
--  syn:
 CREATE MATERIALIZED VIEW viewname(BULID IMMEDIATE | BUILD DEFERRED)
(REFERSH FAST)N( ON DEMAND | ON COMMIT) AS
 Selet query;
--  ex:
 CREATE MATERIALIZED VIEW employ_mtd1REFRSH FAST AS
Select * from employee
--  if primary key  checks
alter table EMPLOYEE 
ADD constraint empoloyee_pk PRIMARY KEY(EMPLOYEE_ID);

-- 1.defernatiely need to be there primary key
-- 2.need to create a log table
-- SYN:
CREATE MATERIALIZED VIEW LOG ON employee
 -- to check the log for the Dictonary table
 select * from user_mview_logs
-- After only need to create mview
CREATE MATERIALIZED VIEW employ_fast_mtd1
REFRESH FAST AS
Select * from EMPLOYEE

i am deleting the one records in base table:
DELETE FROM EMPLOYEE
WHERE EMPLOYEE_ID='3'
-- alter checking the log table for checking deleted data 
SELECT * FROM MLOG$_EMPLOYEE	


-- REFESH METHODS FOR THE MVIEWS -'F- menans fast refesh'
BEGIN
DBMS_MVIEW.REFRESH('employ_fast_mtd1','F');
END;

-- ** after refreshing the data that particular data only scaned and refresh the data

-- Method -2( data is no data found in 1st time after refresh the data will rechived)
CREATE MATERIALIZED VIEW employ_fast_mtd2
BUILD DEFERRED
REFRESH FAST AS
Select * from EMPLOYEE
-- before run the fast need to run complete:
BEGIN
DBMS_MVIEW.REFRESH('employ_fast_mtd1','C');
END;
-- method -3
CREATE MATERIALIZED VIEW employ_fast_mtd3
REFRESH FAST ON COMMIT
AS
Select * from EMPLOYEE

-- method -4
CREATE MATERIALIZED VIEW employ_fast_mtd4
BUILD DEFERRED
REFRESH FAST ON COMMIT
AS
Select * from EMPLOYEE
